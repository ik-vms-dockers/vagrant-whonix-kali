{
  "variables": {
    "tag": "kali-linux",
    "version": "2019.2.0"
  },
  "builders": [
    {
      "type": "vagrant",
      "provider": "virtualbox",
      "add_force": true,
      "communicator": "ssh",
      "source_path": "offensive-security/kali-linux",
      "box_version": "{{user `version`}}"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "expect_disconnect": true,
      "inline": [
        "curl -fsSL https://raw.github.com/hashicorp/vagrant/master/keys/vagrant.pub > /home/vagrant/.ssh/authorized_keys",
        "sudo nmcli connection modify 'Wired connection 1' ipv4.method manual ipv4.addresses 10.152.152.11/18 ipv4.gateway 10.152.152.10 ipv4.dns 10.152.152.10"
      ]
    }
  ],
  "post-processors": [
    {
      "type": "shell-local",
      "inline": [
        "vagrant box remove --force '{{user `tag`}}' || true",
        "vagrant box add --name '{{user `tag`}}' 'file://output-vagrant/package.box'"
      ]
    }
  ]
}
